<!DOCTYPE html>
<html lang="zh-CN" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FrameFlow AI - V14.4 Ultimate Engine (Launch Ready)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet" />

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'Noto Sans SC', 'sans-serif'] },
                    colors: {
                        brand: { 500: '#2563eb', 600: '#1d4ed8' },
                        dark: { bg: '#0f0f11', surface: '#18181b', border: '#27272a' }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.6s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { transition: background-color 0.3s, color 0.3s; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .dark .glass {
            background: rgba(24, 24, 27, 0.8);
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        /* é£æ ¼é€‰æ‹©å™¨æ ·å¼ */
        select.style-selector {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            appearance: none;
        }
    </style>
</head>

<body class="bg-gray-50 text-slate-900 dark:bg-dark-bg dark:text-white h-screen flex flex-col overflow-hidden">

    <nav class="h-16 px-6 flex justify-between items-center fixed top-0 w-full z-50 glass transition-colors">
        <div class="flex items-center gap-2 cursor-pointer" onclick="goLanding()">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-blue-500/30">
                <i data-lucide="aperture" class="w-5 h-5"></i>
            </div>
            <span class="font-bold text-lg tracking-tight hidden md:inline">FrameFlow AI</span>
        </div>

        <div class="flex items-center gap-4">
            <select id="lang-select" onchange="changeLanguage(this.value)" class="bg-transparent text-xs font-medium outline-none cursor-pointer">
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="en">English</option>
                <option value="ja">æ—¥æœ¬èª</option>
            </select>

            <button onclick="toggleTheme()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-white/10 transition">
                <i data-lucide="sun" class="w-4 h-4 hidden dark:hidden" id="icon-sun"></i>
                <i data-lucide="moon" class="w-4 h-4 hidden dark:block" id="icon-moon"></i>
            </button>

            <div id="auth-guest" class="flex items-center gap-2 border-l border-gray-200 dark:border-white/10 pl-4">
                <button onclick="openModal('auth')" class="text-xs font-bold hover:text-brand-600 transition" data-i18n="nav_login">ç™»å½•</button>
                <button onclick="openModal('auth')" class="text-xs font-bold bg-slate-900 dark:bg-white text-white dark:text-black px-4 py-2 rounded-full hover:opacity-90 transition shadow-lg shadow-brand-500/20" data-i18n="nav_signup">æ³¨å†Œ</button>
            </div>
            <div id="auth-user" class="hidden items-center gap-3 border-l border-gray-200 dark:border-white/10 pl-4">
                <button onclick="goProjects()" class="text-xs font-medium hover:text-brand-600 transition flex items-center gap-1">
                    <i data-lucide="grid" class="w-3 h-3"></i> <span data-i18n="nav_projects">æˆ‘çš„é¡¹ç›®</span>
                </button>
                <div id="user-badge" class="px-2 py-0.5 rounded text-[10px] font-black uppercase bg-gray-200 dark:bg-gray-800 text-gray-500 dark:text-gray-400 tracking-widest">FREE</div>
                <div onclick="openModal('referral')" class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full text-white flex items-center justify-center font-bold text-xs cursor-pointer hover:ring-2 ring-offset-2 ring-brand-500 transition-all">U</div>
            </div>
        </div>
    </nav>

    <div id="page-landing" class="flex-1 overflow-y-auto pt-24 pb-12 px-4 scroll-smooth">
        <div class="max-w-5xl mx-auto text-center animate-slide-up">
            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-blue-50 dark:bg-blue-500/10 text-blue-600 dark:text-blue-300 text-[10px] font-bold tracking-wide uppercase mb-6 border border-blue-100 dark:border-blue-500/20">
                <i data-lucide="zap" class="w-3 h-3"></i> <span data-i18n="hero_tag">V14.4 Launch Ready</span>
            </span>
            
            <h1 class="text-5xl md:text-7xl font-extrabold tracking-tight text-slate-900 dark:text-white mb-6 leading-[1.1]">
                <span data-i18n="hero_title_1">AI åˆ›æ„å¼•æ“</span><br/>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-600 to-purple-600" data-i18n="hero_title_2">æ•…äº‹è„šæœ¬ + è§†é¢‘åˆ†é•œ</span>
            </h1>
            
            <p class="text-lg md:text-xl text-slate-500 dark:text-gray-400 max-w-2xl mx-auto mb-10 font-light" data-i18n="hero_sub">
                ä»çµæ„Ÿåˆ°ä¸“ä¸šåˆ†é•œï¼Œåªéœ€ 10 ç§’ã€‚è®©åˆ›ä½œè€…å›å½’æ‹æ‘„ï¼ŒAI æå®šç»“æ„ã€‚
            </p>

            <div class="max-w-2xl mx-auto relative z-10 mb-16">
                <div class="bg-white/80 dark:bg-white/5 backdrop-blur-xl rounded-xl p-2 flex items-center shadow-2xl border border-gray-200 dark:border-white/10 transform hover:scale-[1.01] transition-transform duration-300">
                    <input type="text" id="user-input" data-placeholder-i18n="input_placeholder" placeholder="ä¾‹å¦‚ï¼šæ‹ä¸€ä¸ªå…³äº AI é‡è§äººç±»æ—¥å¸¸ç”Ÿæ´»çš„æç¬‘çŸ­ç‰‡..." 
                        class="w-full bg-transparent text-slate-900 dark:text-white placeholder-slate-400 p-3 outline-none font-medium text-sm md:text-base"
                        onkeypress="handleEnter(event)">
                    <button onclick="startGen(true)" class="px-6 py-3 rounded-lg bg-slate-900 dark:bg-white hover:opacity-90 text-white dark:text-black font-bold text-sm transition flex items-center gap-2 shrink-0 shadow-lg">
                        <span data-i18n="btn_generate">ç”Ÿæˆè„šæœ¬</span>
                        <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="mt-4 flex justify-center gap-3 text-xs text-gray-400">
                    <span>Try:</span>
                    <button onclick="quickFill('æ‚¬ç–‘çŸ­å‰§ Â· åè½¬ç»“å±€')" class="hover:text-brand-600 underline">ğŸ¬ æ‚¬ç–‘åè½¬</button>
                    <button onclick="quickFill('ç¾å¦†å¼€ç®± Â· 20ç§’')" class="hover:text-purple-600 underline">ğŸ’„ ç¾å¦†å¼€ç®±</button>
                </div>
            </div>

            <div class="mb-20 border-y border-gray-200 dark:border-white/5 py-8 bg-white/50 dark:bg-white/[0.02]">
                <p class="text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 dark:text-gray-500 mb-6" data-i18n="partners_title">Trusted by Creative Teams</p>
                <div class="flex flex-wrap justify-center items-center gap-12 opacity-60 grayscale hover:grayscale-0 transition-all duration-500">
                    <i data-lucide="dribbble" class="w-6 h-6"></i>
                    <i data-lucide="figma" class="w-6 h-6"></i>
                    <i data-lucide="twitch" class="w-6 h-6"></i>
                    <i data-lucide="chrome" class="w-6 h-6"></i>
                    <i data-lucide="youtube" class="w-6 h-6"></i>
                </div>
            </div>

            <div class="grid md:grid-cols-3 gap-6 text-left max-w-6xl mx-auto px-2 pb-20">
                <div class="bg-white/60 dark:bg-white/5 backdrop-blur-md p-6 rounded-2xl border border-gray-200 dark:border-white/10 hover:-translate-y-2 transition-transform duration-300 group">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="file-text" class="w-5 h-5"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-2" data-i18n="feat_1_title">AI æ•…äº‹è„šæœ¬</h3>
                    <p class="text-sm text-slate-500 dark:text-gray-400 leading-relaxed" data-i18n="feat_1_desc">è‡ªåŠ¨ç”Ÿæˆåˆ†åœºæ™¯æ•…äº‹è„šæœ¬ã€å¯¹ç™½ã€VO æ–‡æ¡ˆã€‚ç»“æ„åŒ–è¾“å‡ºï¼Œç›´æ¥å¯ç”¨ã€‚</p>
                </div>

                <div class="bg-white/60 dark:bg-white/5 backdrop-blur-md p-6 rounded-2xl border border-gray-200 dark:border-white/10 hover:-translate-y-2 transition-transform duration-300 group">
                    <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="image" class="w-5 h-5"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-2" data-i18n="feat_2_title">åŠ¨æ€å¯è§†åŒ–åˆ†é•œ</h3>
                    <p class="text-sm text-slate-500 dark:text-gray-400 leading-relaxed" data-i18n="feat_2_desc">æä¾› AI ç”Ÿæˆçš„çº¿æ¡å‚è€ƒå›¾ï¼Œæ”¯æŒæ‹–æ‹½è°ƒæ•´ï¼Œå°†åˆ›æ„å¯è§†åŒ–å‘ˆç°ã€‚</p>
                </div>

                <div class="bg-white/60 dark:bg-white/5 backdrop-blur-md p-6 rounded-2xl border border-gray-200 dark:border-white/10 hover:-translate-y-2 transition-transform duration-300 group">
                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="check-square" class="w-5 h-5"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-2" data-i18n="feat_3_title">æ™ºèƒ½æ‹æ‘„æ¸…å•</h3>
                    <p class="text-sm text-slate-500 dark:text-gray-400 leading-relaxed" data-i18n="feat_3_desc">è‡ªåŠ¨é™„å¸¦æ‹æ‘„åœºæ™¯ã€ç¯å…‰ã€é“å…·æ¸…å•ï¼Œç¡®ä¿ç°åœºæ‰§è¡Œæ— è¯¯ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <div id="page-projects" class="hidden flex-1 overflow-y-auto pt-24 pb-12 px-6 bg-gray-50 dark:bg-dark-bg">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-slate-900 dark:text-white" data-i18n="gallery_title">æˆ‘çš„é¡¹ç›®åº“</h2>
                <button onclick="openModal('new-project')" class="bg-slate-900 dark:bg-white text-white dark:text-black px-4 py-2 rounded-lg text-sm font-bold hover:opacity-90 transition flex items-center gap-2">
                    <i data-lucide="plus" class="w-4 h-4"></i> <span data-i18n="btn_new_project">æ–°å»ºé¡¹ç›®</span>
                </button>
            </div>
            <div id="project-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
            <div id="empty-state" class="hidden text-center py-20 opacity-50">
                <i data-lucide="folder-open" class="w-16 h-16 mx-auto mb-4 text-gray-400"></i>
                <p class="text-sm text-gray-500" data-i18n="gallery_empty">æš‚æ— é¡¹ç›®ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»º</p>
            </div>
        </div>
    </div>

    <div id="page-workspace" class="hidden flex-col flex-1 pt-16 bg-gray-50 dark:bg-dark-bg h-full overflow-hidden">
        <div class="h-16 bg-white dark:bg-dark-surface border-b border-gray-200 dark:border-dark-border flex items-center justify-between px-4 shrink-0">
            <div class="flex items-center gap-3 overflow-hidden">
                <button onclick="goProjects()" class="p-1.5 hover:bg-gray-100 dark:hover:bg-white/10 rounded text-gray-500"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                <div class="flex flex-col min-w-0">
                    <span id="workspace-title" class="text-sm font-bold text-slate-900 dark:text-white truncate max-w-[150px] md:max-w-xs">Project Title</span>
                    <span class="text-[10px] text-gray-400" id="last-saved-time">Unsaved</span>
                </div>
            </div>

            <div class="flex items-center gap-2 md:gap-3">
                <div class="relative hidden md:block group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="palette" class="h-3.5 w-3.5 text-gray-400 group-hover:text-brand-500 transition-colors"></i>
                    </div>
                    <select id="style-select" class="style-selector text-xs font-bold bg-gray-100 dark:bg-white/5 border-none rounded-lg py-2 pl-9 pr-8 text-slate-700 dark:text-gray-200 focus:ring-2 focus:ring-brand-500 outline-none cursor-pointer transition-all">
                        <option value="cinematic" data-i18n="style_cinematic">ğŸ¥ ç”µå½±è´¨æ„Ÿ</option>
                        <option value="anime" data-i18n="style_anime">ğŸ‡¯ğŸ‡µ åŠ¨æ¼«é£æ ¼</option>
                        <option value="tvc" data-i18n="style_tvc">ğŸ“º å•†ä¸šå¹¿å‘Š</option>
                        <option value="sketch" data-i18n="style_sketch">âœï¸ çº¿ç¨¿è‰å›¾</option>
                    </select>
                </div>

                <button onclick="regenerateProject()" class="group relative flex items-center gap-2 px-4 py-2 bg-slate-900 dark:bg-white text-white dark:text-black rounded-lg text-xs font-bold hover:opacity-90 transition shadow-lg overflow-hidden">
                    <span id="regen-count-badge" class="absolute -top-[1px] -right-[1px] flex h-2.5 w-2.5">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
                    </span>
                    
                    <i data-lucide="refresh-cw" class="w-3.5 h-3.5 group-hover:rotate-180 transition-transform duration-500"></i>
                    <span data-i18n="btn_regenerate">é‡æ–°ç”Ÿæˆ</span>
                    <span id="regen-text-limit" class="ml-1 bg-white/20 dark:bg-black/10 px-1.5 rounded text-[9px] font-mono opacity-80">3 Free</span>
                </button>

                <div class="h-5 w-px bg-gray-200 dark:bg-white/10 mx-1"></div>

                <button onclick="saveCurrentProject()" class="p-2 text-slate-500 hover:bg-gray-100 dark:hover:bg-white/5 rounded" title="Save">
                    <i data-lucide="save" class="w-4 h-4"></i>
                </button>
                <button onclick="triggerProFeature()" class="hidden md:flex px-3 py-2 text-xs font-bold text-slate-600 dark:text-gray-300 border border-gray-200 dark:border-dark-border rounded hover:bg-gray-50 dark:hover:bg-white/5 gap-2">
                    <i data-lucide="download" class="w-3.5 h-3.5"></i> <span data-i18n="btn_export">PDF</span>
                </button>
            </div>
        </div>

        <div class="flex-1 flex overflow-hidden p-2 gap-2">
            <div class="w-1/4 min-w-[240px] bg-white dark:bg-dark-surface rounded-lg border border-gray-200 dark:border-dark-border flex flex-col shadow-sm hidden md:flex">
                <div class="p-3 border-b border-gray-100 dark:border-dark-border text-[10px] font-bold uppercase text-gray-400 tracking-widest" data-i18n="col_script">æ•…äº‹è„šæœ¬</div>
                <div class="flex-1 overflow-y-auto p-4 space-y-6" id="script-container"></div>
            </div>
            <div class="flex-1 bg-white dark:bg-dark-surface rounded-lg border border-gray-200 dark:border-dark-border flex flex-col shadow-sm relative">
                <div class="p-3 border-b border-gray-100 dark:border-dark-border text-[10px] font-bold uppercase text-gray-400 tracking-widest flex justify-between items-center">
                    <span data-i18n="col_board">å¯è§†åŒ–åˆ†é•œ</span>
                    <div class="flex gap-2 items-center">
                        <span id="current-style-tag" class="text-[9px] bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-1.5 py-0.5 rounded border border-blue-100 dark:border-blue-500/20">Cinematic</span>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50/50 dark:bg-black/20" id="board-container"></div>
                <div class="p-3 border-t border-gray-200 dark:border-dark-border bg-white dark:bg-dark-surface">
                    <button onclick="triggerProFeature()" class="w-full py-2 border border-dashed border-gray-300 dark:border-dark-border rounded text-xs text-gray-500 hover:text-brand-600 hover:border-brand-500 transition flex justify-center gap-2">
                        <i data-lucide="plus" class="w-3 h-3"></i> <span data-i18n="btn_addshot">æ·»åŠ é•œå¤´</span>
                    </button>
                </div>
            </div>
            <div class="w-1/5 min-w-[200px] bg-white dark:bg-dark-surface rounded-lg border border-gray-200 dark:border-dark-border flex flex-col shadow-sm hidden lg:flex">
                <div class="p-3 border-b border-gray-100 dark:border-dark-border text-[10px] font-bold uppercase text-gray-400 tracking-widest" data-i18n="col_list">æ‹æ‘„æ¸…å•</div>
                <div class="flex-1 overflow-y-auto p-4 space-y-2" id="list-container"></div>
            </div>
        </div>
    </div>

    <div id="page-loading" class="hidden fixed inset-0 bg-white/90 dark:bg-dark-bg/90 backdrop-blur-sm z-[60] flex-col items-center justify-center">
        <div class="w-16 h-16 border-4 border-blue-100 dark:border-blue-900 border-t-brand-600 dark:border-t-brand-500 rounded-full animate-spin mb-6"></div>
        <h2 id="loading-text" class="text-lg font-semibold text-slate-800 dark:text-gray-200 animate-pulse">Thinking...</h2>
        <p class="text-xs text-gray-400 mt-2" id="loading-sub">Applying new style parameters...</p>
    </div>

    <div id="modal-auth" class="hidden fixed inset-0 z-[70] flex items-center justify-center animate-fade-in">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal('auth')"></div>
        <div class="relative bg-white dark:bg-dark-surface w-[360px] rounded-xl shadow-2xl p-8 flex flex-col items-center text-center border border-gray-200 dark:border-dark-border">
            <h3 class="text-xl font-bold mb-2 text-slate-900 dark:text-white" data-i18n="modal_auth_title">ç™»å½•è´¦æˆ·</h3>
            <p class="text-xs text-gray-500 dark:text-gray-400 mb-6" data-i18n="modal_auth_desc">ç™»å½•ä»¥ä¿å­˜é¡¹ç›®è¿›åº¦ã€‚</p>
            <button onclick="login()" class="w-full bg-slate-900 dark:bg-white text-white dark:text-black py-2.5 rounded-lg text-sm font-bold hover:scale-[1.02] transition-transform" data-i18n="btn_login_action">æ¨¡æ‹Ÿç™»å½•</button>
        </div>
    </div>

    <div id="modal-referral" class="hidden fixed inset-0 z-[70] flex items-center justify-center animate-fade-in">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal('referral')"></div>
        <div class="relative bg-white dark:bg-dark-surface w-[420px] rounded-2xl shadow-2xl overflow-hidden border border-gray-200 dark:border-dark-border flex flex-col">
            <div class="bg-gradient-to-br from-brand-600 to-purple-600 p-6 text-white text-center relative overflow-hidden">
                <div class="absolute -right-4 -top-4 bg-white/20 w-24 h-24 rounded-full blur-2xl"></div>
                <h3 class="text-2xl font-bold mb-1" data-i18n="modal_limit_title">å…è´¹æ¬¡æ•°å·²ç”¨å®Œ</h3>
                <p class="text-blue-100 text-xs opacity-90" data-i18n="modal_limit_sub">æ‚¨å·²ä½¿ç”¨äº† 3 æ¬¡å…è´¹é‡æ–°ç”Ÿæˆæœºä¼šã€‚</p>
            </div>
            <div class="p-6 bg-white dark:bg-dark-surface">
                <div class="text-center mb-6 pb-6 border-b border-gray-100 dark:border-white/10">
                    <p class="text-xs text-gray-500 mb-2">è®¢é˜… Pro è§£é”æ— é™ç”Ÿæˆ</p>
                    <div class="text-3xl font-black text-slate-900 dark:text-white mb-1">$19.99<span class="text-sm font-medium text-gray-400">/mo</span></div>
                    <button class="w-full bg-slate-900 dark:bg-white text-white dark:text-black py-2 rounded-lg font-bold text-sm hover:opacity-90 mt-2" data-i18n="btn_subscribe">ç«‹å³è®¢é˜…</button>
                </div>
                <div>
                    <div class="flex justify-between text-xs font-bold mb-2 text-slate-800 dark:text-gray-200">
                        <span id="invite-text">é‚€è¯·å¥½å‹ (0/3)</span>
                        <span class="text-purple-600 dark:text-purple-400" data-i18n="reward_text">å¾— 1 å‘¨ Pro</span>
                    </div>
                    <div class="w-full h-2 bg-gray-100 dark:bg-white/10 rounded-full overflow-hidden mb-4">
                        <div id="invite-bar" class="h-full bg-gradient-to-r from-brand-500 to-purple-500 w-0 transition-all duration-500"></div>
                    </div>
                    <div class="flex gap-2 mb-4">
                        <div class="flex-1 bg-gray-50 dark:bg-black/30 border border-gray-200 dark:border-dark-border rounded px-3 py-2 text-xs text-gray-500 font-mono truncate">frameflow.ai/u/demo</div>
                        <button onclick="copyLink()" class="bg-white dark:bg-white/5 border border-gray-200 dark:border-dark-border hover:border-brand-500 text-slate-900 dark:text-white px-3 rounded text-xs font-bold transition" data-i18n="btn_copy">å¤åˆ¶</button>
                    </div>
                    <button onclick="simulateInvite()" class="w-full py-2 text-xs font-bold text-purple-600 dark:text-purple-400 hover:underline" data-i18n="btn_simulate_invite">æ¨¡æ‹Ÿé‚€è¯· (æ¼”ç¤º +1)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed top-6 left-1/2 transform -translate-x-1/2 bg-white dark:bg-gray-800 text-slate-900 dark:text-white px-4 py-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex items-center gap-2 z-[100] transition-all duration-300 opacity-0 translate-y-[-20px] pointer-events-none">
        <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
        <span id="toast-msg" class="text-xs font-bold">Notification</span>
    </div>

    <script>
        // --- æ ¸å¿ƒå®‰å…¨å‡½æ•° (A/F è§’è‰²å¼•å…¥) ---
        // å…³é”®ä¿®å¤ï¼šé˜²æ­¢ XSS æ”»å‡»
        const entityMap = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;', '/': '&#x2F;', '`': '&#x60;', '=': '&#x3D;'};
        function escapeHtml(string) {
            return String(string).replace(/[&<>"'`=\/]/g, s => entityMap[s]);
        }
        
        // --- é…ç½®ä¸æ•°æ® (REFACTOR: config -> state) ---
        const state = {
            lang: 'zh-CN',
            theme: localStorage.getItem('ff_theme') || 'system',
            isLoggedIn: false,
            isPro: false,
            inviteCount: 0,
            freeRegenCount: 3,
            currentProjectId: null,
            currentStyle: 'cinematic',
            // V14.3/V14.4 FIX: ç¨³å®šçš„ Picsum é“¾æ¥å¹¶ä½¿ç”¨ seed ä¿è¯éšæœºæ€§
            projects: [
                { id: 1, title: "æ‚¬ç–‘çŸ­å‰§ï¼šæ¶ˆå¤±çš„é›¨ä¼", date: "2023-10-24", thumb: "https://picsum.photos/seed/150/300/200" }
            ]
        };

        const i18n = {
            "zh-CN": {
                // D è§’è‰²æ›´æ–° Hero Tag
                hero_tag: "V14.4 Launch Ready", hero_title_1: "AI åˆ›æ„å¼•æ“", hero_title_2: "æ•…äº‹è„šæœ¬ + è§†é¢‘åˆ†é•œ",
                hero_sub: "ä»çµæ„Ÿåˆ°ä¸“ä¸šåˆ†é•œï¼Œåªéœ€ 10 ç§’ã€‚è®©åˆ›ä½œè€…å›å½’æ‹æ‘„ï¼ŒAI æå®šç»“æ„ã€‚",
                btn_generate: "ç”Ÿæˆè„šæœ¬", btn_regenerate: "é‡æ–°ç”Ÿæˆ", btn_new_project: "æ–°å»ºé¡¹ç›®",
                gallery_title: "æˆ‘çš„é¡¹ç›®åº“", gallery_empty: "æš‚æ— é¡¹ç›®ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»º",
                nav_projects: "æˆ‘çš„é¡¹ç›®", nav_login: "ç™»å½•", nav_signup: "æ³¨å†Œ",
                col_script: "æ•…äº‹è„šæœ¬", col_board: "å¯è§†åŒ–åˆ†é•œ", col_list: "æ‹æ‘„æ¸…å•",
                btn_save: "ä¿å­˜", btn_export: "å¯¼å‡º PDF", btn_addshot: "æ·»åŠ é•œå¤´",
                modal_auth_title: "ç™»å½•è´¦æˆ·", modal_auth_desc: "ç™»å½•ä»¥ä¿å­˜é¡¹ç›®ã€‚", btn_login_action: "æ¨¡æ‹Ÿç™»å½•",
                modal_limit_title: "å…è´¹æ¬¡æ•°å·²ç”¨å®Œ", modal_limit_sub: "å‡çº§ Pro æˆ–é‚€è¯·å¥½å‹ä»¥ç»§ç»­ç”Ÿæˆã€‚",
                btn_subscribe: "ç«‹å³è®¢é˜…", reward_text: "å…è´¹å¾— 1 å‘¨ Pro", btn_copy: "å¤åˆ¶", btn_simulate_invite: "æ¨¡æ‹Ÿé‚€è¯· (æ¼”ç¤º +1)",
                toast_welcome: "æ¬¢è¿å›æ¥ï¼", toast_saved: "é¡¹ç›®å·²ä¿å­˜", toast_style: "é£æ ¼å·²æ›´æ–°", toast_pro: "Pro ä¼šå‘˜å·²è§£é”ï¼",
                style_cinematic: "ğŸ¥ ç”µå½±è´¨æ„Ÿ", style_anime: "ğŸ‡¯ğŸ‡µ åŠ¨æ¼«é£æ ¼", style_tvc: "ğŸ“º å•†ä¸šå¹¿å‘Š", style_sketch: "âœï¸ çº¿ç¨¿è‰å›¾",
                loading: "AI æ­£åœ¨æ€è€ƒ...", partners_title: "åˆä½œä¼™ä¼´ä¸ä¿¡ä»»å›¢é˜Ÿ",
                feat_1_title: "AI æ•…äº‹è„šæœ¬", feat_1_desc: "è‡ªåŠ¨ç”Ÿæˆåˆ†åœºæ™¯æ•…äº‹è„šæœ¬ã€å¯¹ç™½ã€VO æ–‡æ¡ˆã€‚ç»“æ„åŒ–è¾“å‡ºï¼Œç›´æ¥å¯ç”¨ã€‚",
                feat_2_title: "åŠ¨æ€å¯è§†åŒ–åˆ†é•œ", feat_2_desc: "æä¾› AI ç”Ÿæˆçš„çº¿æ¡å‚è€ƒå›¾ï¼Œæ”¯æŒæ‹–æ‹½è°ƒæ•´ï¼Œå°†åˆ›æ„å¯è§†åŒ–å‘ˆç°ã€‚",
                feat_3_title: "æ™ºèƒ½æ‹æ‘„æ¸…å•", feat_3_desc: "è‡ªåŠ¨é™„å¸¦æ‹æ‘„åœºæ™¯ã€ç¯å…‰ã€é“å…·æ¸…å•ï¼Œç¡®ä¿ç°åœºæ‰§è¡Œæ— è¯¯ã€‚"
            },
            "en": { /* (English translations omitted for brevity in final output) */ },
            "ja": { /* (Japanese translations omitted for brevity in final output) */ }
        };

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('lang-select').value = state.lang;
            changeLanguage(state.lang);
            initTheme();
            lucide.createIcons();
            updateRegenUI();
        });

        // --- æ ¸å¿ƒé€»è¾‘å‡½æ•° ---
        function changeLanguage(lang) {
            state.lang = lang;
            const t = i18n[lang] || i18n['en'];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const k = el.getAttribute('data-i18n');
                if(t[k]) el.innerText = t[k];
            });
            document.querySelectorAll('[data-placeholder-i18n]').forEach(el => {
                const k = el.getAttribute('data-placeholder-i18n');
                if(t[k]) el.placeholder = t[k];
            });
            updateRegenUI();
        }

        function initTheme() {
            const isDark = state.theme === 'dark' || (state.theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
            document.documentElement.classList.toggle('dark', isDark);
            document.getElementById('icon-sun').classList.toggle('hidden', isDark);
            document.getElementById('icon-moon').classList.toggle('hidden', !isDark);
        }
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            html.classList.toggle('dark', !isDark);
            localStorage.setItem('ff_theme', !isDark ? 'dark' : 'light');
            state.theme = !isDark ? 'dark' : 'light';
            initTheme();
        }

        function goLanding() { hideAllPages(); document.getElementById('page-landing').classList.remove('hidden'); }
        function goProjects() {
            if(!state.isLoggedIn) { openModal('auth'); return; }
            hideAllPages();
            document.getElementById('page-projects').classList.remove('hidden');
            renderProjects();
        }
        function hideAllPages() {
            document.getElementById('page-landing').classList.add('hidden');
            document.getElementById('page-projects').classList.add('hidden');
            document.getElementById('page-workspace').classList.add('hidden');
            document.getElementById('page-workspace').classList.remove('flex');
        }
        function login() {
            closeModal('auth');
            state.isLoggedIn = true;
            document.getElementById('auth-guest').classList.add('hidden');
            document.getElementById('auth-user').classList.remove('hidden');
            document.getElementById('auth-user').classList.add('flex');
            showToast(i18n[state.lang].toast_welcome);
            goProjects();
        }

        function startGen(fromLanding=false) {
            const val = document.getElementById('user-input').value;
            if(!val) return;
            if(!state.isLoggedIn && !fromLanding) { openModal('auth'); return; }
            if(!state.isLoggedIn && fromLanding) { openModal('auth'); return; }

            document.getElementById('loading-text').innerText = i18n[state.lang].loading;
            document.getElementById('page-landing').classList.add('hidden');
            document.getElementById('page-projects').classList.add('hidden');
            document.getElementById('page-loading').classList.remove('hidden');
            document.getElementById('page-loading').classList.add('flex');

            setTimeout(() => {
                document.getElementById('page-loading').classList.add('hidden');
                document.getElementById('page-loading').classList.remove('flex');
                // V14.3 FIX: æ–°å»ºé¡¹ç›®æ—¶ä½¿ç”¨ç¨³å®šçš„ Picsum é“¾æ¥å’Œéšæœºç§å­
                const newProj = { 
                    id: Date.now(), 
                    title: val, 
                    date: new Date().toISOString().split('T')[0], 
                    thumb: `https://picsum.photos/seed/${Date.now()}/300/200`
                };
                state.projects.unshift(newProj);
                openProject(newProj.id);
            }, 2000);
        }

        function openProject(id) {
            const p = state.projects.find(x => x.id === id);
            state.currentProjectId = id;
            hideAllPages();
            document.getElementById('page-workspace').classList.remove('hidden');
            document.getElementById('page-workspace').classList.add('flex');
            // å®‰å…¨ï¼šé¡¹ç›®æ ‡é¢˜æ¥è‡ªç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨ innerText èµ‹å€¼ï¼Œé˜²èŒƒ XSS
            document.getElementById('workspace-title').innerText = p.title; 
            injectMockContent();
        }

        function regenerateProject() {
            // V14.0 - æ£€æŸ¥æ¬¡æ•°é™åˆ¶
            if (!state.isPro && state.freeRegenCount <= 0) {
                openModal('referral');
                return;
            }
            const styleSelect = document.getElementById('style-select');
            state.currentStyle = styleSelect.value;
            if (!state.isPro) {
                state.freeRegenCount--;
                updateRegenUI();
            }
            document.getElementById('loading-sub').innerText = `Redrawing in ${state.currentStyle} style...`;
            document.getElementById('page-loading').classList.remove('hidden');
            document.getElementById('page-loading').classList.add('flex');
            setTimeout(() => {
                document.getElementById('page-loading').classList.add('hidden');
                document.getElementById('page-loading').classList.remove('flex');
                injectMockContent();
                showToast(i18n[state.lang].toast_style);
                const t = i18n[state.lang];
                const label = t['style_' + state.currentStyle] || state.currentStyle;
                document.getElementById('current-style-tag').innerText = label.replace(/^[^\s]+\s/, '');
            }, 1500);
        }

        function updateRegenUI() {
            const badge = document.getElementById('regen-count-badge');
            const text = document.getElementById('regen-text-limit');
            if (state.isPro) {
                badge.classList.add('hidden');
                text.innerText = "Unlimited";
                text.className = "ml-1 bg-gradient-to-r from-brand-500 to-purple-500 text-white px-1.5 rounded text-[9px] font-bold";
            } else {
                badge.classList.toggle('hidden', state.freeRegenCount <= 0);
                if (state.freeRegenCount > 0) {
                    text.innerText = `${state.freeRegenCount} Free`;
                    text.className = "ml-1 bg-white/20 dark:bg-black/10 px-1.5 rounded text-[9px] font-mono opacity-80";
                } else {
                    text.innerText = "LOCKED";
                    text.className = "ml-1 bg-red-500 text-white px-1.5 rounded text-[9px] font-bold";
                }
            }
        }

        // V14.2 FIX: æ›¿æ¢å·¥ä½œå°åˆ†é•œå›¾é“¾æ¥ä¸ºç¨³å®šçš„ Picsum
        function injectMockContent() {
            let seedBase = 100;
            if (state.currentStyle === 'anime') seedBase = 200;
            else if (state.currentStyle === 'tvc') seedBase = 300;
            else if (state.currentStyle === 'sketch') seedBase = 400;
            
            const rand1 = Math.floor(Math.random() * 100) + seedBase;
            const rand2 = Math.floor(Math.random() * 100) + seedBase + 1;

            // æ³¨å…¥åˆ†é•œå¡ç‰‡ (ä½¿ç”¨ picsum.photos ç¨³å®šå›¾æº)
            document.getElementById('board-container').innerHTML = `
                <div class="bg-white dark:bg-dark-surface p-3 rounded border border-gray-200 dark:border-dark-border shadow-sm flex gap-3 group hover:border-brand-500/50 transition-all">
                    <div class="w-32 h-20 bg-gray-200 dark:bg-black rounded overflow-hidden relative">
                        <img src="https://picsum.photos/300/200?random=${rand1}" class="w-full h-full object-cover opacity-90 group-hover:scale-105 transition duration-500">
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between mb-1"><span class="text-xs font-bold dark:text-white">Shot 1: Intro</span> <span class="text-[10px] bg-gray-100 dark:bg-white/10 px-1 rounded">Wide</span></div>
                        <p class="text-[10px] text-gray-500 dark:text-gray-400">Establishing shot with ${state.currentStyle} lighting.</p>
                    </div>
                </div>
                <div class="bg-white dark:bg-dark-surface p-3 rounded border border-gray-200 dark:border-dark-border shadow-sm flex gap-3 group hover:border-brand-500/50 transition-all">
                    <div class="w-32 h-20 bg-gray-200 dark:bg-black rounded overflow-hidden relative">
                        <img src="https://picsum.photos/300/200?random=${rand2}" class="w-full h-full object-cover opacity-90 group-hover:scale-105 transition duration-500">
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between mb-1"><span class="text-xs font-bold dark:text-white">Shot 2: Detail</span> <span class="text-[10px] bg-gray-100 dark:bg-white/10 px-1 rounded">CU</span></div>
                        <p class="text-[10px] text-gray-500 dark:text-gray-400">Close up details, high contrast.</p>
                    </div>
                </div>
            `;
            document.getElementById('script-container').innerHTML = `<div class="pl-3 border-l-2 border-brand-500 mb-4"><div class="text-xs text-brand-600 dark:text-brand-400 font-mono mb-1">00:00 - SCENE 1</div><p class="text-xs text-slate-700 dark:text-gray-300">(${state.currentStyle} Style) The camera moves slowly...</p></div>`;
            document.getElementById('list-container').innerHTML = `<div class="flex items-center gap-2 text-xs text-slate-600 dark:text-gray-400"><input type="checkbox" checked> <span>Camera A</span></div>`;
        }

        // --- è¾…åŠ©å‡½æ•° ---
        function renderProjects() {
            const grid = document.getElementById('project-grid');
            grid.innerHTML = '';
            state.projects.forEach(p => {
                const card = document.createElement('div');
                card.className = "bg-white dark:bg-dark-surface rounded-xl overflow-hidden shadow-sm hover:shadow-md border border-gray-200 dark:border-dark-border group relative transition-all hover:-translate-y-1";
                
                // V14.4 SECURITY FIX: å¯¹ç”¨æˆ·è¾“å…¥çš„æ ‡é¢˜è¿›è¡Œè½¬ä¹‰
                const safeTitle = escapeHtml(p.title);

                // ä½¿ç”¨è½¬ä¹‰åçš„æ ‡é¢˜æ’å…¥åˆ° innerHTML ä¸­
                card.innerHTML = `
                    <div class="h-32 bg-gray-200 relative overflow-hidden cursor-pointer" onclick="openProject(${p.id})">
                        <img src="${p.thumb}" class="w-full h-full object-cover opacity-90 group-hover:scale-105 transition duration-500">
                    </div>
                    <div class="p-4">
                        <h3 class="text-sm font-bold text-slate-900 dark:text-white truncate cursor-pointer" onclick="openProject(${p.id})">${safeTitle}</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400">${p.date}</p>
                    </div>
                `;
                grid.appendChild(card);
            });
            if(state.projects.length===0) document.getElementById('empty-state').classList.remove('hidden');
            else document.getElementById('empty-state').classList.add('hidden');
        }
        function saveCurrentProject() { document.getElementById('last-saved-time').innerText = "Saved now"; showToast(i18n[state.lang].toast_saved); }
        function quickFill(t) { document.getElementById('user-input').value = t; }
        function handleEnter(e) { if(e.key === 'Enter') startGen(true); }
        function openModal(id) { document.getElementById('modal-'+id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById('modal-'+id).classList.add('hidden'); }
        function showToast(msg, isErr=false) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.querySelector('i').setAttribute('data-lucide', isErr ? 'alert-circle' : 'check-circle');
            lucide.createIcons(); // ç¡®ä¿å›¾æ ‡è¢«æ¸²æŸ“
            t.classList.remove('translate-y-[-20px]', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-[-20px]', 'opacity-0'), 3000);
        }
        function triggerProFeature() { if(!state.isLoggedIn) { openModal('auth'); return; } if(state.isPro) showToast("Pro Active"); else openModal('referral'); }
        function copyLink() { navigator.clipboard.writeText("https://frameflow.ai/u/demo"); showToast(i18n[state.lang].btn_copy); }
        function simulateInvite() {
            // B è§’è‰²ä¼˜åŒ–ï¼šå¦‚æœå·²ç»æ˜¯ Proï¼Œåˆ™é€€å‡º
            if (state.isPro) return; 

            if(state.inviteCount < 3) {
                state.inviteCount++;
                const pct = (state.inviteCount/3)*100;
                document.getElementById('invite-bar').style.width = `${pct}%`;
                document.getElementById('invite-text').innerText = `${state.lang==='en'?'Invite Friends':'é‚€è¯·å¥½å‹'} (${state.inviteCount}/3)`;
                if(state.inviteCount >= 3) {
                    setTimeout(() => {
                        state.isPro = true;
                        showToast(i18n[state.lang].toast_pro);
                        document.getElementById('user-badge').innerText = "PRO";
                        document.getElementById('user-badge').className = "px-2 py-0.5 rounded text-[10px] font-black uppercase bg-gradient-to-r from-brand-500 to-purple-600 text-white tracking-widest";
                        updateRegenUI();
                        closeModal('referral');
                    }, 800);
                }
            }
        }
    </script>
</body>
</html>